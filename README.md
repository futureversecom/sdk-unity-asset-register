# Asset Register SDK

A Unity client for the Asset Register. Provides an API for creating and sending requests to the AR GraphQL server.

See https://ar-docs.futureverse.app/ for details on the Asset Register.

## Installation

Go to the Unity Package Manager window, and select `Add package from git URL...` and enter this link https://github.com/futureversecom/sdk-unity-asset-register.git?path=Assets/Plugins/AssetRegister (append `#vX.X.X` to specify a version). Alternatively, you can get a .unitypackage from the Releases page.

## Getting Started

This example script shows a simple Asset Register request. It queries the Asset schema, including only the `id` field. After checking that the request has succeeded, the response is parsed for the Asset, and the `id` is logged.

```csharp
public class Example : MonoBehaviour
{
  [SerializeField] private MonoClient _client;
  [SerializeField] private string _collectionId;
  [SerializeField] private string _tokenId;

  private IEnumerator Start()
  {
    IResponse response = null;

    yield return AR.NewQuery()
      .Add(new AssetQuery(_collectionId, _tokenId))
        .WithField(a => a.Id)
      .Execute(_client, r => response = r);

    if (!response.Success)
    {
      Debug.LogError(response.Error);
      yield break;
    }

    if (response.TryGetModel<Asset>(out var asset))
    {
      Debug.Log(asset.Id);
    }
  }
}
```

To use this script, add it to a GameObject in your scene. You will also need to add the MonoClient component, and add it to the `Client` field of the `Example` component. 

![image](https://github.com/user-attachments/assets/8f39e359-59f0-4d83-8cc5-00ef9e4db993)

To complete the test, you can use

* Collection ID: `11155111:evm:0x85225575aae6e8275e3d2be9e86268f916f3e2be`
* Token ID: `400`

Enter play mode, and you should see the Asset's ID pop up in the Console window.

You can see the [equivalent request](https://ar-api.futureverse.cloud/graphql?explorerURLState=N4IgJg9gxgrgtgUwHYBcQC4QEcYIE4CeABAIIDOZCKAFACQoQDWyAkmOkQMop4CWSAcwCEAGiK0oEADZSEUFLwhI2HAMLTZ8xcrBCAlEWAAdJESIBDClWoNmOjvSaswYyTLkKlK8W82edBsamZkS8YCZmAL4mkSAiIABu5nzmAEayZBggwGZGeBFERiC2zkUcRUUieQVFvh7abGWFIBX5SLGRQA) in the Futureverse GraphQL Sandbox.

## Breaking It Down

Let's go through the above script step by step, to see exactly how this is working.

### MonoBehaviour
```csharp
public class Example : MonoBehaviour
{
  [SerializeField] private MonoClient _client;
  [SerializeField] private string _collectionId;
  [SerializeField] private string _tokenId;
```
This script is a MonoBehaviour, so you can add it as a component in your scene. It serializes the Collection ID and Token ID, so you can edit those fields directly on the commponent. It also serializes a MonoClient, which implements the IClient interface. The client is responsible for sending a request and producing a response.

### Query Builder
```csharp
  yield return AR.NewQuery()
    .Add(new AssetQuery(_collectionId, _tokenId))
      .WithField(a => a.Id)
    .Execute(_client, r => response = r);
```
These lines use the RequestBuilder API to create a query of the Asset schema, and then passes that to the client to produce a response.
* `yield return AR.NewQuery()` Creates a new QueryBuilder object.
* `.Add(new AssetQuery(_collectionId, _tokenId))` Adds the Asset query to the QueryBuilder. It requires the Collection ID and Token ID, as these inputs are necessary to run the query.
* `.WithField(a => a.Id)` Uses an Expression to select the ID field of the Asset, and adds that to the query.
* `.Execute(_client, r => response = r);` Is a shorthand for calling `Build()` on the QueryBuilder to produce a request and then `IClient.SendRequest()`. It takes a callback parameter that is used to set the local `response` variable.

### Checking Success
```csharp
  if (!response.Success)
  {
    Debug.LogError(response.Error);
    yield break;
  }
```
Here we check the Success property of the IResponse object that was generated by the QueryBuilder. If that returns false, we know there were errors with the query. We can then print the Error property of the response to see what went wrong, and break from the function.

### Getting the Asset
```csharp
  if (response.TryGetModel<Asset>(out var asset))
  {
    Debug.Log(asset.Id);
  }
```
The IResponse object also provides the `TryGetModel<T>` method. Because multiple queries can be added to the QueryBuilder, the response could contain more than one schema, so the `TryGetModel<T>` usage here checks if the response contains an Asset schema, deserializes it into the out parameter, and then uses that to print the ID. It's important to note that because we only added the ID field to the query, all other properties of the `asset` object will be null.

## Request Builder

### Fields

### Methods

### Unions

### Interfaces

Coming soon...

### Caching Requests

## Helper Methods
